"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9776],{6187:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var t=s(4848),r=s(8453);const i={},o="Nginx v\xe0 SSL",c={id:"operating-system/nginx",title:"Nginx v\xe0 SSL",description:"I. T\u1ed5ng quan",source:"@site/content/operating-system/nginx.md",sourceDirName:"operating-system",slug:"/operating-system/nginx",permalink:"/blog/content/operating-system/nginx",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/content/operating-system/nginx.md",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Git",permalink:"/blog/content/operating-system/git"},next:{title:"SSH",permalink:"/blog/content/operating-system/ssh"}},l={},a=[{value:"I. T\u1ed5ng quan",id:"i-t\u1ed5ng-quan",level:2},{value:"II. OpenSSL",id:"ii-openssl",level:2},{value:"III. Let&#39;s Encrypt - Certbot",id:"iii-lets-encrypt---certbot",level:2},{value:"IV. File c\u1ea5u h\xecnh conf.d",id:"iv-file-c\u1ea5u-h\xecnh-confd",level:2},{value:"V. Docker",id:"v-docker",level:2},{value:"VI. Run and test",id:"vi-run-and-test",level:2},{value:"VII. VSCode Live server",id:"vii-vscode-live-server",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nginx-v\xe0-ssl",children:"Nginx v\xe0 SSL"})}),"\n",(0,t.jsx)(n.h2,{id:"i-t\u1ed5ng-quan",children:"I. T\u1ed5ng quan"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nginx-project\n\u251c\u2500\u2500 nginx\n\u2502   \u251c\u2500\u2500 conf.d\n\u2502   \u2502   \u251c\u2500\u2500 default.conf\n\u2502   \u2502   \u2514\u2500\u2500 other-domain.conf\n\u2502   \u2514\u2500\u2500 ssl\n\u2502       \u251c\u2500\u2500 letsencrypt\n\u2502       \u2514\u2500\u2500 openssl\n\u2502\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 index.html\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ii-openssl",children:"II. OpenSSL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Windows kh\xf4ng c\xe0i \u0111\u1eb7t openssl --\x3e C\u1ea7n c\xe0i \u0111\u1eb7t git-scm: ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://git-scm.com/download/win",children:"https://git-scm.com/download/win"})})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Tr\xean Windows d\xf9ng CMD cd v\xe0o th\u01b0 m\u1ee5c c\u1ee7a git \u0111\u1ec3 run \u0111\u01b0\u1ee3c openssl"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Phi\xean b\u1ea3n OpenSSL 1.1.1 c\xf3 h\u1ed7 tr\u1ee3 TLS 1.3"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Generate cert.pem and key.pem"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title="Windows"',children:'cd C:\\Program Files\\Git\\usr\\bin \nopenssl version -a\nopenssl req -days 3650 -x509 -newkey rsa:2048 -sha256 -nodes -keyout %UserProfile%\\Desktop\\key.pem -out %UserProfile%\\Desktop\\cert.pem -subj "/C=/ST=/L=/O=/OU=web/CN=example.com"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title="Linux"',children:'sudo chmod -R 777 nginx\nmkdir -p ./nginx/ssl/openssl\nopenssl req -days 3650 -x509 -newkey rsa:2048 -sha256 -nodes -keyout ./nginx/ssl/openssl/key.pem -out ./nginx/ssl/openssl/cert.pem -subj "/C=/ST=/L=/O=/OU=web/CN=example.com"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'# -nodes : no DES - no passphrase\n# -days 365\n# -x509: this option outputs a self signed certificate instead of a certificate request. This is typically used to generate a test certificate or a self signed root CA.\n# -sha256: use SHA-2 instead SHA-1\n# -subj "/C=/ST=/L=/O=/OU=web/CN=medihome.vn" : Country/State/Locality(city)/Organization/Organization Unit/CommonName(required)\n# -keyout key.pem -out cert.pem: file \u0111\u1ecbnh d\u1ea1ng PEM c\xf3 extension: .pem, .crt, .cer, .key\n'})}),"\n",(0,t.jsx)(n.h2,{id:"iii-lets-encrypt---certbot",children:"III. Let's Encrypt - Certbot"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'rm -rf /etc/letsencrypt/archive/*\nrm -rf ~/mea-nestjs/nginx/ssl/letsencrypt/*\nsudo docker run -it --rm --name certbot -v "/etc/letsencrypt:/etc/letsencrypt" -v "/var/lib/letsencrypt:/var/lib/letsencrypt" -p 80:80 certbot/certbot certonly\nls -la /etc/letsencrypt/archive/*\ncp -R /etc/letsencrypt/archive/* ~/mea-nestjs/nginx/ssl/letsencrypt/\ncd ~/mea-nestjs/nginx/ssl/letsencrypt/\nls -la\nmv mea.ga-0003 mea.ga\ncd ~/mea-nestjs/\ndocker compose -f docker.nginx.yml up -d\n'})}),"\n",(0,t.jsx)(n.h2,{id:"iv-file-c\u1ea5u-h\xecnh-confd",children:"IV. File c\u1ea5u h\xecnh conf.d"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"T\u1ea1o file default.conf"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:'title="Linux"',children:"mkdir -p ./nginx/conf.d\ntouch ./nginx/conf.d/default.conf\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"S\u1eeda n\u1ed9i dung nh\u01b0 sau"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-conf",metastring:'title="./nginx/conf.d/default.conf"',children:"server {\n    listen       443 ssl;\n    server_name  localhost;\n\n    ssl_certificate           /etc/nginx/ssl/openssl/cert.pem;\n    ssl_certificate_key       /etc/nginx/ssl/openssl/key.pem;\n    ssl_protocols             TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers               'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';\n\n    location / {\n        proxy_pass http://10.0.13.80:4000/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forward-Proto http;\n        proxy_set_header X-Nginx-Proxy true;\n        proxy_redirect off;\n    }\n\n    location /test {\n        root   /etc/nginx/dist;\n        index  test.html test.htm;\n    }\n\n    location /about {\n        add_header Content-Type text/html;\n        return 200 '<h2>This is About Page</body></h2>';\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n\nserver {\n    listen        80;\n    server_name   localhost;\n    return        301 https://$host$request_uri;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"v-docker",children:"V. Docker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",metastring:'title="./docker-compose.yml"',children:'version: "3.8"\n\nnetworks:\n  mn_network:\n    driver: bridge\n\nservices:\n  nginx:\n    container_name: mc_nginx\n    image: nginx:1.23.3-alpine\n    restart: unless-stopped\n    networks:\n      - mn_network\n    volumes:\n      - ./nginx/conf.d/:/etc/nginx/conf.d/\n      - ./nginx/adminer.d/:/etc/nginx/adminer.d/\n      - ./nginx/ssl/:/etc/nginx/ssl/\n    ports:\n      - "80:80"\n      - "443:443"\n      # - "23080:23080"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"vi-run-and-test",children:"VI. Run and test"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Run container\ndocker compose up -d\n\n# Check syntax\ndocker exec mc_nginx nginx -t\n\n# Reload nginx\ndocker exec mc_nginx nginx -s reload\n"})}),"\n",(0,t.jsx)(n.p,{children:"Test:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://localhost",children:"https://localhost"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://localhost/about",children:"https://localhost/about"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://localhost/test",children:"https://localhost/test"})})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"vii-vscode-live-server",children:"VII. VSCode Live server"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"T\u1ea1i settings.json c\u1ee7a VScode"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "liveServer.settings.port": 5501,\n    "liveServer.settings.root": "/",\n    "liveServer.settings.CustomBrowser": "chrome",\n    "liveServer.settings.https": {\n      "enable": true,\n      "cert": "/Users/duyk3/.vscode/https/cert.pem",\n      "key": "/Users/duyk3/.vscode/https/key.pem",\n      "passphrase": ""\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);