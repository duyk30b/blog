"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5254],{3278:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>i,toc:()=>h});var d=s(4848),t=s(8453);const r={},c="Transaction",i={id:"database/sql/transaction",title:"Transaction",description:"A.C\xe1c ch\u1ebf  \u0111\u1ed9 lock",source:"@site/content/database/sql/transaction.md",sourceDirName:"database/sql",slug:"/database/sql/transaction",permalink:"/blog/content/database/sql/transaction",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/content/database/sql/transaction.md",tags:[],version:"current",frontMatter:{},sidebar:"sqlSidebar",previous:{title:"SQL SERVER",permalink:"/blog/content/database/sql/sql-server"}},l={},h=[{value:"A. C\xe1c lo\u1ea1i Anomaly",id:"a-c\xe1c-lo\u1ea1i-anomaly",level:2},{value:"1. Dirty Reads",id:"1-dirty-reads",level:3},{value:"2. Nonrepeatable Reads",id:"2-nonrepeatable-reads",level:3}];function a(e){const n={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"transaction",children:"Transaction"})}),"\n",(0,d.jsx)("h3",{children:"A.C\xe1c ch\u1ebf  \u0111\u1ed9 lock "}),"\n",(0,d.jsx)("blockquote",{children:"UPDATE user SET username = 'Bob' WHERE id = '1';\t"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Exclusive lock (lock \u0111\u1ed9c quy\u1ec1n): Row user c\xf3 id = 1 s\u1ebd b\u1ecb exclusive lock ==> C\xe1c transaction kh\xe1c ph\u1ea3i ch\u1edd c\xe2u l\u1ec7nh tr\xean th\u1ef1c hi\u1ec7n xong"}),"\n",(0,d.jsx)(n.li,{children:"Share lock (lock chia s\u1ebb): B\u1ea3ng user s\u1ebd b\u1ecb share lock n\xean c\xe1c transaction kh\xe1c s\u1ebd kh\xf4ng th\u1ec3 c\u1eadp nh\u1eadt c\u1ea5u tr\xfac c\u1ee7a n\xf3 (v\xec \u0111\u1ec3 thay \u0111\u1ed5i c\u1ea5u tr\xfac b\u1ea3ng th\xec c\u1ea7n ph\u1ea3i ti\u1ebfn h\xe0nh exclusive lock b\u1ea3ng). Tuy nhi\xean c\xe1c transaction kh\xe1c v\u1eabn c\xf3 th\u1ec3 thay \u0111\u1ed5i c\xe1c d\xf2ng kh\xe1c c\u1ee7a b\u1ea3ng employees (khi \u0111\xf3 b\u1ea3ng employees s\u1ebd b\u1ecb nhi\u1ec1u share lock)."}),"\n"]}),"\n",(0,d.jsx)("h3",{children:"B.C\xe1c lo\u1ea1i lock "}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"DDL lock (lock c\u1ea5u tr\xfac): c\xf3 ch\u1ee9c n\u0103ng b\u1ea3o v\u1ec7 c\u1ea5u tr\xfac c\u1ee7a c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng trong schema, v\xed d\u1ee5 nh\u01b0 b\u1ea3ng, view,"}),"\n",(0,d.jsx)(n.li,{children:"DML lock (lock d\u1eef li\u1ec7u):"}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Th\u01b0\u1eddng th\xec SELECT kh\xf4ng ph\u1ea3i \u0111\u1ee3i UPDATE"}),"\n",(0,d.jsx)(n.li,{children:"UPDATE ph\u1ea3i \u0111\u1ee3i nhau n\u1ebfu c\xf9ng ghi tr\xean 1 d\xf2ng"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"a-c\xe1c-lo\u1ea1i-anomaly",children:"A. C\xe1c lo\u1ea1i Anomaly"}),"\n",(0,d.jsx)(n.h3,{id:"1-dirty-reads",children:"1. Dirty Reads"}),"\n",(0,d.jsx)(n.p,{children:"Transaction 2 \u0111\u1ecdc d\u1eef li\u1ec7u ch\u01b0a \u0111\u01b0\u01a1c commit \u1edf transaction 1"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"1"}),(0,d.jsx)(n.th,{children:"2"}),(0,d.jsx)(n.th,{children:"DATA"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Alice'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"UPDATE user SET username = 'Bob' WHERE id = '1';"}),(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Bob'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"SELECT username FROM user where id = '1';"}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Bob'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"COMMIT;"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ROLLBACK;"}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Alice'"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"2-nonrepeatable-reads",children:"2. Nonrepeatable Reads"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Transaction 2 \u0111\u1ecdc d\u1eef li\u1ec7u 2 l\u1ea7n ra 2 k\u1ebft qu\u1ea3 kh\xe1c nhau"}),"\n"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"1"}),(0,d.jsx)(n.th,{children:"2"}),(0,d.jsx)(n.th,{children:"DATA"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Alice'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{children:"SELECT username FROM user where id = '1';"}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Alice'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"UPDATE user SET username = 'Bob' WHERE id = '1';"}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Bob'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"COMMIT;"}),(0,d.jsx)(n.td,{children:"SELECT username FROM user where id = '1';"}),(0,d.jsx)(n.td,{children:"id = 1, username = 'Bob'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"COMMIT;"}),(0,d.jsx)(n.td,{})]})]})]}),"\n",(0,d.jsx)("h3",{children:"3. Phantom Record: B\u1ea3n ghi ma "}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"B\u1ea3n ghi 'Bob' \u0111\xe3 \u0111\u01b0\u1ee3c th\xeam v\xe0 l\xe0m cho k\u1ebft qu\u1ea3 \u0111\u1ecdc 2 l\u1ea7n sai l\u1ec7ch"}),"\n"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"1"}),(0,d.jsx)(n.th,{children:"2"}),(0,d.jsx)(n.th,{children:"DATA"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{children:"START TRANSACTION;"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"SELECT username FROM user where group_id = '1';"}),(0,d.jsx)(n.td,{children:"'Alice'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"INSERT INTO user (id, group_id, username) VALUES (4,1,'Bob');"}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{children:"SELECT username FROM user where group_id = '1';"}),(0,d.jsx)(n.td,{children:"'Alice','Bob'"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"COMMIT;"}),(0,d.jsx)(n.td,{children:"COMMIT;"}),(0,d.jsx)(n.td,{})]})]})]}),"\n",(0,d.jsx)("h2",{children:"B. Isolation level"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{}),(0,d.jsx)(n.th,{children:"Read Uncommitted"}),(0,d.jsx)(n.th,{children:"Read Committed"}),(0,d.jsx)(n.th,{children:"Repeatable Read"}),(0,d.jsx)(n.th,{children:"Serializable"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"UPDATE \u0111\u1ee3i transaction kh\xe1c COMMIT UPDATE"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SELECT \u0111\u1ee3i transaction kh\xe1c COMMIT UPDATE"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LOCK khi SELECT (kh\xf4ng cho transaction kh\xe1c update)"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LOCK khi SELECT (kh\xf4ng cho transaction kh\xe1c delete, insert)"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"Y"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Dirt Read"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Nonerepeatable Read"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"N"}),(0,d.jsx)(n.td,{children:"N"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Fantom Read"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"Y"}),(0,d.jsx)(n.td,{children:"N"})]})]})]})]})}function x(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var d=s(6540);const t={},r=d.createContext(t);function c(e){const n=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),d.createElement(r.Provider,{value:n},e.children)}}}]);